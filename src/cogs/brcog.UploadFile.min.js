"use strict";(function(n,t){function i(){this._version="18.11.8";this._attributeName="br-uploadfile";this.brUploadFile=function(t,r){var f,u,e,h;if(!r.brUploadFile){r.brUploadFile=!0;var o=n(r),a=i._attributeName,s=r.attributes[a],c="";try{if(typeof FileReader=="undefined")throw"FileReader object not supported for Brisk UploadFile plugin. Try using a Modernizr module such as dopfile.js";if(f=t.parseJSON(s.value,t,s),u=f.posturl,u&&typeof u!="string")throw"[postUrl] is required.";if(e=!1,u=f.allowmultiple,typeof u=="string"?e=u.toBool():typeof u=="boolean"&&(e=u),h="*",u=f.mimetypes,typeof u=="string"&&(h=u),o.click(function(){if(r.uploading||r.getAttribute("disabled"))return!1;var u=n("<input type='file' style='visibility:hidden;position:absolute;z-index:-1;'>");return n(document.forms[0]).append(u),u[0].multiple=e,u[0].accept=h,u.change(function(){var n=u[0];f.timeStamp=Date.now();i.uploadList(t,r,n.files,f);u.remove()}),u.click(),!0}),u=f.dragdrop,typeof u=="string"&&(f.dragdrop=u.toBool()),f.dragdrop){o.on("dragover",function(n){n.stopPropagation();n.preventDefault();n.originalEvent.dataTransfer.dropEffect="copy"});o.on("drop",function(n){if(n.stopPropagation(),n.preventDefault(),r.uploading||r.getAttribute("disabled"))return!1;f.timeStamp=Date.now();i.uploadList(t,r,n.originalEvent.dataTransfer.files,f)})}}catch(l){if(c="ERROR: "+l,t.isDebug)throw l;}finally{s.value=c}}};this.uploadList=function(n,t,i,r){var h,c,e,o,l,u;for(t.uploading=!0,h=i.length,c=h,h>0&&r.progresscallback&&r.progresscallback(t,0),e=0;e<h;e++){if(o=i[e],l=o.name,o.size<1){c--;alert("["+l+"] is an empty file and will be ignored.");c===0&&(t.uploading=!1);continue}var s=o.type,f=l,v=f.lastIndexOf("."),a="";v>-1&&(a=f.substring(v,f.length),f=f.substring(0,v));a&&!s&&(s="application/"+a.substring(1));s||(s="application/octet-stream");u=new FileReader;u.fileName=l+"";u.shortName=f+"";u.fileExtension=a+"";u.mime=s+"";u.options=r;u.timeStamp=r.timeStamp;u.fileNumber=e+1;u.validFileCount=c;u.onloadend=function(i){var r=i.target.options,c=i.target.validFileCount,a=i.target.fileName,y=i.target.timeStamp,v=i.target.mime,p=i.target.shortName,w=i.target.fileExtension,b=i.target.fileNumber,f,h,s,l;if(!i.target.result){c--;alert("["+a+"] too large to upload. Some browsers limit the size of local file requests. Use a different browser or try breaking the file down into smaller pieces.");c===0&&(t.uploading=!1);return}var e=i.target.result.byteLength?i.target.result.byteLength:i.total,o=1,u=579344;for(r.speedchunksize&&(u=r.speedchunksize),typeof u=="string"&&(u=Number.parseInt(u)),typeof u=="number"&&u>0&&e>u&&(o=Math.floor(e/u),e%u>0&&o++),f=1;f<=o;f++)h=null,s=e,o===1?h=new Uint8Array(i.target.result).toBase64():(l=(f-1)*u,s=u,f*u>e&&(s=e-l),h=new Uint8Array(i.target.result.slice(l,l+s)).toBase64()),s=h.length,f===1&&typeof r.callback=="function"&&r.callback(t,{readySate:4,responseText:"",status:202,statusText:"Upload Started",fileName:a,mime:v,fileCount:c,fileParts:o}),n.ajaxCall(n,t,r.posturl,"POST",{command:"upload",timeStamp:y,fileName:a,shortName:p,fileExtension:w,mime:v,reusable:r.reusable,fileCount:c,fileNumber:b,fileParts:o,part:f,chunkSize:s,upFile:h},function(n,i){r.callback&&typeof r.callback=="function"&&r.callback(t,i)},function(n,i){r.errorcallback&&typeof r.errorcallback=="function"&&r.errorcallback(t,i)},function(){},function(n){r.progresscallback&&typeof r.progresscallback=="function"&&r.progresscallback(t,n);n===100&&(r.reusable&&(t.uploading=!1),r.startstopcallback&&typeof r.startstopcallback=="function"&&r.startstopcallback(t,!1))},!0,"application/json","ascii","json");delete i.target.result};r.startstopcallback&&typeof r.startstopcallback=="function"&&r.startstopcallback(t,!0);setTimeoutW(function(){u.readAsArrayBuffer(o)},5)}}}i=new i;t.registerAttr(i._attributeName,i.brUploadFile)})($,B_);